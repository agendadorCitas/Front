<div class="content-wrapper">

  <!-- Content Header (Page header) -->
  <section class="content-header">
    <h1>
      Registro de citas
      <small></small>
    </h1>
    <ol class="breadcrumb">
      <li><a href="/v1/inicio"><i class="fa fa-home"></i>Home</a></li>
    </ol>
  </section>

  <!-- Main content -->
  <section class="content">

    <!-- Default box -->
    <div class="box">
      <div class="box-header with-border">
        <h3 class="box-title">
          <!-- Boton de nuevo registro -->
          <button type="button" class="btn btn-info" data-toggle="modal" data-target="#modal-info">
            Nuevo registro
          </button>
        </h3>

        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
            <i class="fa fa-minus"></i></button>
          <button type="button" class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip" title="Remove">
            <i class="fa fa-times"></i></button>
      </div>
    </div>

      <div class="box-body">
        <div class="col-sm-12">
          <!-- Tabla donde se muestra la informacion -->
          <table id="example2" style="table-layout: fixed;" class="table table-bordered table-hover dataTable" role="grid"
            aria-describedby="example2_info">
            <thead>
              <tr role="row">
                <th class="sorting_asc" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">
                  Cedula
                </th>
                <th class="sorting" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-label="Browser: activate to sort column ascending">
                  Nombre
                </th>
                <th class="sorting_asc" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">
                  Apellido
                </th>
                <th class="sorting_asc" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">
                  Telefono
                </th>
                <th class="sorting_asc" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">
                  Direccion
                </th>
                <th class="sorting_asc" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">
                  Correo
                </th>
                <th class="sorting_asc" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">
                  Laboratorio
                </th>
                <th class="sorting_asc" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">
                  Fecha
                </th>
                <th class="sorting_asc" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">
                  Hora de la cita
                </th>
                <th class="sorting_asc" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">
                  Costo de la cita

                </th>
                <th class="sorting_asc" tabindex="0" aria-controls="example2" rowspan="1" colspan="1"
                  aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">
                  Opciones
                </th>
              </tr>
            </thead>
            <tbody>
              <% datos.forEach((elements)=> { %>
                <tr role="row" class="odd">
                  <td style="word-wrap: break-word;">
                    <%= elements.cedula %>
                  </td>
                  <td style="word-wrap: break-word;">
                    <%= elements.nombre %>
                  </td>
                  <td style="word-wrap: break-word;">
                    <%= elements.apellido %>
                  </td>
                  <td style="word-wrap: break-word;">
                    <%= elements.telefono %>
                  </td>
                  <td style="word-wrap: break-word;">
                    <%= elements.direccion %>
                  </td>
                  <td style="word-wrap: break-word;">
                    <%= elements.correo %>
                  </td>
                  <td style="word-wrap: break-word;">
                    <%= elements.laboratory %>
                  </td>
                  <td style="word-wrap: break-word;">
                    <%= elements.fecha %>
                  </td>
                  <td style="word-wrap: break-word;">
                    <%= elements.horaCita %>
                  </td>
                  <td style="word-wrap: break-word;">
                    <%= elements.costoCita %>
                  </td>
                  <td style="word-wrap: break-word;">
                    <a href="editA?id=<%= elements.id %>&cedula=<%= elements.cedula %>&nombre=<%= elements.nombre %>&apellido=<%= elements.apellido %>&telefono=<%= elements.telefono %>&direccion=<%= elements.direccion %>&correo=<%= elements.correo %>&idLab=<%= elements.idLab %>&fecha=<%= elements.fecha %>&horaCita=<%= elements.horaCita %>&costoCita=<%= elements.costoCita %>" class="btn btn-warning">
                      <i class="fa fa-edit"></i>
                    </a>

                    <a class="btn btn-danger" onclick="deleteA(`<%=elements.id %>`);">
                      <i class="fa fa-trash"></i>
                    </a>
                  </td>
                </tr>
                <% }) %>

          </table>
          <!-- Generar informe PDF -->
          <form action="generatePdf" method="post">
            <input type="hidden" name="datos">
            <label for="formato">Generar reporte de citas: </label>
            <button class="btn btn-primary" type="submit">
                  Generar reporte
            </button>
          </form>
        </div>
      </div>
      <!-- /.box-body -->

  </section>
  <div class="modal modal-info fade" id="modal-info">
    <div class="modal-dialog">
      <div class="modal-content">
        <!-- Formulario para guardar una cita -->
        <form action="appointSave" name="formAppointment" id="formAppointment" method="post">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Ingrese los datos</h4>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <span class="input-group-addon">Cedula</span>
              <input name="cedula" id="cedula" type="text" class="form-control" placeholder="Cedula">
            </div>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <span class="input-group-addon">Nombre</span>
              <input name="nombre" id="nombre" type="text" class="form-control" placeholder="Nombre">
            </div>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <span class="input-group-addon">Apellido</span>
              <input name="apellido" id="apellido" type="text" class="form-control" placeholder="Apellido">
            </div>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <span class="input-group-addon">Telefono</span>
              <input name="telefono" id="telefono" type="text" class="form-control" placeholder="Telefono">
            </div>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <span class="input-group-addon">Direccion</span>
              <input name="direccion" id="direccion" type="text" class="form-control" placeholder="Direccion">
            </div>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <span class="input-group-addon">Correo</span>
              <input name="correo" id="correo" type="text" class="form-control" placeholder="Correo">
            </div>
          </div>

          <div class="modal-body">
            <div class="input-group">
              <span class="input-group-addon">Laboratorios</span>
              <select class="form-control" name="idLab" id="idLab">
               <% datosSedes.forEach((datos)=>{ %>
                <option value="<%= datos.id %>"><%= datos.laboratory %></option>
               <% }) %>
              </select>
            </div>
          </div>

          <div class="modal-body">
            <div class="input-group">
              <span class="input-group-addon">Fecha</span>
              <input name="fecha" id="fecha" type="date" class="form-control" placeholder="Fecha" pattern="\d{2}-\d{2}-\d{4}" required>
            </div>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <span class="input-group-addon">Hora de la cita</span>
              <input name="horaCita" id="horaCita" type="text" class="form-control" placeholder="Hora cita" pattern="[0-9]{2}:[0-9]{2}" required>
            </div>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <span class="input-group-addon">Valor de la cita</span>
              <input name="costoCita" id="costoCita" type="text" class="form-control" placeholder="Valor">
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-outline pull-left" data-dismiss="modal"> Cancelar </button>
            <button type="submit" class="btn btn-outline" onclick="addAppointment()"> Guardar </button>
          </div>
        </form>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
  
</div>
<!-- Archivos donde se realizan las validaciones -->
<script src="/resources/js/validaciones.js"></script>

<script>
  //Alerta para borrar informacio
  function deleteA(id) {
    Swal.fire({
      title: 'Estas completamente seguro?',
      text: "Quieres eliminar el siguiente usuario?",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'SI'
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = `deleAppointment?id=${id}`
        Swal.fire(
          'Eliminado!',
          'Su registro ah sido eliminado corretamente',
          'success'
        )
      }
    })
  }

//Alerta para insertar informacion
  function addAppointment() {
  const form = document.querySelector("#formAppointment");
    form.addEventListener("submit", event => {
      event.preventDefault();
        Swal.fire({
        title: '¿Estas seguro de guardar la cita?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
            confirmButtonText: '¡Si, Guardar!'
}).then((result) => {
    if (result.isConfirmed) {
      form.submit();
        Swal.fire(
          'Guardado Exitosamente!',
          'success')}
      })
      })
      }
</script>